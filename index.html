<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ°´æœæ•°å­¦åˆ‡åˆ‡ä¹ - äºŒå¹´çº§åŠ å‡æ³•æ¸¸æˆ</title>
    <style>
        /* æ‰€æœ‰åŸæœ‰æ ·å¼ä¿æŒä¸å˜ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'æ¥·ä½“', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ffccd5, #c9f5ff);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            transition: padding 0.3s ease;
        }
        
        .container {
            width: 110%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        h1 {
            color: #ff6b6b;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #ffd166;
            transition: all 0.3s ease;
        }
        
        .subtitle {
            color: #06d6a0;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .game-info {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .score, .timer, .lives {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .score { color: #118ab2; }
        .timer { color: #ef476f; }
        .lives { color: #06d6a0; }
        
        .current-problem {
            font-size: 2.5rem;
            font-weight: bold;
            color: #073b4c;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .game-screen {
            position: relative;
            width: 100%;
            height: 400px;
            background: linear-gradient(to bottom, #a9e4f7, #fafcc2);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            border: 3px solid #ffd166;
            touch-action: none;
            transition: all 0.3s ease;
        }
        
        /* æ–°å¢ï¼šæ¸¸æˆå¼€å§‹å‰å…è®¸æ»šåŠ¨çš„æ ·å¼ */
        .game-screen.scrollable {
            overflow-y: auto;
            touch-action: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .game-screen.scrollable::after {
            display: none; /* éšè—ç™½è‰²æç¤ºæ¡ */
        }
        
        .fruit {
            position: absolute;
            text-align: center;
            font-weight: bold;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            user-select: none;
            transition: transform 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 10;
            -webkit-tap-highlight-color: transparent;
        }
        
        .fruit:hover {
            transform: scale(1.05);
        }
        
        /* æ°´æœåŠè¾¹çš„æ ·å¼ */
        .fruit-half {
            position: absolute;
            width: 40px;
            height: 80px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 24px;
            z-index: 5;
            pointer-events: none;
        }
        
        .fruit-half.left {
            left: 0;
            border-radius: 40px 0 0 40px;
        }
        
        .fruit-half.right {
            right: 0;
            border-radius: 0 40px 40px 0;
        }
        
        .fruit-half-inner {
            position: absolute;
            width: 80px;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .fruit-half.left .fruit-half-inner {
            left: 0;
        }
        
        .fruit-half.right .fruit-half-inner {
            right: 0;
        }
        
        /* åˆ€å…‰æ•ˆæœ */
        .swipe-effect {
            position: absolute;
            height: 4px;
            background: linear-gradient(to right, rgba(255,255,255,0.8), rgba(255,255,255,0.4));
            border-radius: 2px;
            pointer-events: none;
            z-index: 15;
            transform-origin: 0 50%;
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.7);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            transition: all 0.3s ease;
        }
        
        button {
            padding: 12px 25px;
            font-size: 1.1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            touch-action: manipulation;
        }
        
        .btn-start {
            background: #06d6a0;
            color: white;
        }
        
        .btn-pause {
            background: #ffd166;
            color: white;
        }
        
        .btn-reset {
            background: #118ab2;
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .selector-container {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            gap: 20px;
            transition: all 0.3s ease;
        }
        
        .selector {
            flex: 1;
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .selector h3 {
            color: #073b4c;
            margin-bottom: 10px;
        }
        
        .mode-selector, .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .mode-btn, .difficulty-btn {
            padding: 8px 16px;
            background: #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mode-btn.active, .difficulty-btn.active {
            background: #ff6b6b;
            color: white;
        }
        
        .instructions {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: left;
            overflow-y: auto;
            max-height: 200px;
            transition: all 0.3s ease;
        }
        
        .instructions h3 {
            color: #073b4c;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .juice-effect {
            position: absolute;
            pointer-events: none;
            z-index: 100;
        }
        
        /* æœæ±æ»´æ•ˆæœ */
        .juice-drop {
            position: absolute;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            pointer-events: none;
            z-index: 8;
        }
        
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }
        
        .game-over h2 {
            color: #ef476f;
            margin-bottom: 15px;
        }
        
        .game-over p {
            margin: 10px 0;
            font-size: 1.2rem;
        }
        
        /* æ¸¸æˆæ”¾å¤§æ—¶çš„æ ·å¼ - åªåœ¨ç§»åŠ¨ç«¯åº”ç”¨ */
        body.mobile.game-enlarged {
            padding: 10px;
        }
        
        .container.mobile.game-enlarged {
            max-width: 100%;
            padding: 15px;
            border-radius: 15px;
        }
        
        .mobile.game-enlarged h1 {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .mobile.game-enlarged .subtitle {
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        .mobile.game-enlarged .selector-container,
        .mobile.game-enlarged .instructions {
            display: none;
        }
        
        .mobile.game-enlarged .game-info {
            margin: 10px 0;
            font-size: 1.1rem;
        }
        
        .mobile.game-enlarged .current-problem {
            font-size: 2rem;
            margin: 10px 0;
            padding: 10px;
        }
        
        .mobile.game-enlarged .game-screen {
            height: 65vh; /* ä»55vhå¢åŠ åˆ°65vhï¼Œå¢å¤§æ¸¸æˆåŒºåŸŸ */
            min-height: 350px;
            margin: 5px 0;
        }
        
        .mobile.game-enlarged .controls {
            margin: 15px 0;
            gap: 10px;
        }
        
        /* ç§»åŠ¨ç«¯æ”¾å¤§çŠ¶æ€ä¸‹æŒ‰é’®ç¼©å°15% */
        .mobile.game-enlarged .controls button {
            padding: 10px 20px;
            font-size: 1rem;
            transform: scale(0.85);
        }
        
        .mobile.game-enlarged .controls button:hover {
            transform: scale(0.85) translateY(-3px);
        }
        
        /* æ°´æœåœ¨æ”¾å¤§çŠ¶æ€ä¸‹çš„æ ·å¼ */
        .mobile.game-enlarged .fruit {
            min-width: 80px;
            min-height: 80px;
            font-size: 1.8rem;
        }
        
        /* æ–°å¢ï¼šå¹³æ¿è®¾å¤‡ä¸åº”ç”¨æ”¾å¤§æ ·å¼ */
        .tablet .container.mobile.game-enlarged,
        .tablet.body.mobile.game-enlarged {
            max-width: 800px;
            padding: 20px;
            border-radius: 20px;
        }
        
        .tablet .mobile.game-enlarged h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .tablet .mobile.game-enlarged .subtitle {
            font-size: 1rem;
            margin-bottom: 20px;
        }
        
        .tablet .mobile.game-enlarged .selector-container,
        .tablet .mobile.game-enlarged .instructions {
            display: flex;
        }
        
        .tablet .mobile.game-enlarged .game-info {
            margin: 15px 0;
            font-size: 1.2rem;
        }
        
        .tablet .mobile.game-enlarged .current-problem {
            font-size: 2.5rem;
            margin: 15px 0;
            padding: 15px;
        }
        
        .tablet .mobile.game-enlarged .game-screen {
            height: 400px;
            min-height: auto;
            margin: 10px 0;
        }
        
        .tablet .mobile.game-enlarged .controls {
            margin: 20px 0;
            gap: 15px;
        }
        
        .tablet .mobile.game-enlarged .controls button {
            padding: 12px 25px;
            font-size: 1.1rem;
            transform: none;
        }
        
        .tablet .mobile.game-enlarged .controls button:hover {
            transform: translateY(-3px);
        }
        
        .tablet .mobile.game-enlarged .fruit {
            min-width: 70px;
            min-height: 70px;
            font-size: 1.5rem;
        }
        
        /* é’ˆå¯¹å®‰å“è®¾å¤‡çš„ç‰¹å®šä¼˜åŒ– */
        /* å®‰å“è®¾å¤‡å®¹å™¨ä¼˜åŒ– */
        .android .container {
            max-width: 95%;
            padding: 15px;
            margin: 0 auto;
        }
        
        /* å®‰å“è®¾å¤‡æ§åˆ¶æŒ‰é’®ä¼˜åŒ– */
        .android .controls {
            gap: 8px;
            flex-wrap: nowrap;
            justify-content: space-between;
            width: 100%;
        }
        
        .android .controls button {
            padding: 10px 15px;
            font-size: 0.95rem;
            flex: 1;
            min-width: 0;
            white-space: nowrap;
        }
        
        /* å®‰å“è®¾å¤‡é€‰æ‹©å™¨ä¼˜åŒ– */
        .android .selector-container {
            flex-direction: column;
            gap: 15px;
        }
        
        .android .mode-selector,
        .android .difficulty-selector {
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }
        
        .android .mode-btn,
        .android .difficulty-btn {
            min-width: 80px;
            padding: 10px 15px;
            font-size: 0.9rem;
            text-align: center;
        }
        
        /* é’ˆå¯¹å°å±å¹•å®‰å“è®¾å¤‡çš„è¿›ä¸€æ­¥ä¼˜åŒ– */
        @media (max-width: 360px) {
            .android .container {
                padding: 12px;
                max-width: 98%;
            }
            
            .android h1 {
                font-size: 1.8rem;
            }
            
            .android .subtitle {
                font-size: 0.9rem;
            }
            
            .android .mode-btn,
            .android .difficulty-btn {
                min-width: 70px;
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .android .controls button {
                padding: 8px 10px;
                font-size: 0.85rem;
            }
            
            .android .game-info {
                font-size: 1rem;
            }
            
            .android .current-problem {
                font-size: 1.6rem;
                padding: 10px;
            }
        }

        /* é’ˆå¯¹è¶…å°å±å¹•è®¾å¤‡çš„ä¼˜åŒ– */
        @media (max-width: 320px) {
            .android .controls button {
                padding: 8px 8px;
                font-size: 0.8rem;
            }
            
            .android .mode-btn,
            .android .difficulty-btn {
                min-width: 65px;
                padding: 6px 10px;
                font-size: 0.8rem;
            }
        }

        /* æ–°å¢é’ˆå¯¹å®‰å“è®¾å¤‡çš„æ§åˆ¶æŒ‰é’®ä¼˜åŒ– */
        .android .controls {
            gap: 6px;
            margin: 12px 0;
            justify-content: space-between;
            flex-wrap: nowrap;
        }

        .android .controls button {
            padding: 10px 12px;
            font-size: 0.9rem;
            min-width: 0;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* é’ˆå¯¹å°å±å¹•å®‰å“è®¾å¤‡çš„è¿›ä¸€æ­¥ä¼˜åŒ– */
        @media (max-width: 380px) {
            .android .controls {
                gap: 4px;
                margin: 10px 0;
            }
            
            .android .controls button {
                padding: 8px 10px;
                font-size: 0.85rem;
            }
        }

        /* é’ˆå¯¹è¶…å°å±å¹•å®‰å“è®¾å¤‡ */
        @media (max-width: 340px) {
            .android .controls button {
                padding: 7px 8px;
                font-size: 0.8rem;
            }
        }

        /* è°ƒæ•´å®‰å“è®¾å¤‡å®¹å™¨è¾¹è· */
        .android .container {
            padding: 15px;
            margin: 0 10px;
        }

        /* æ¨ªå±æ¨¡å¼ä¼˜åŒ– */
        @media (max-height: 500px) and (orientation: landscape) {
            .container {
                padding: 15px;
            }
            
            .selector-container {
                flex-direction: row;
                margin: 10px 0;
            }
            
            .game-screen {
                height: 65vh;
                min-height: 250px;
            }
            
            .instructions {
                display: none;
            }
        }
        
        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }
            
            .selector-container {
                flex-direction: column;
            }
            
            .current-problem {
                font-size: 2rem;
            }
            
            .game-screen {
                height: 300px;
            }
            
            button {
                padding: 10px 20px;
                font-size: 1rem;
            }
            
            /* åœ¨ç§»åŠ¨ç«¯é»˜è®¤ä½¿ç”¨æ›´å¤§çš„æ¸¸æˆåŒºåŸŸ */
            .game-screen {
                height: 50vh;
                min-height: 300px;
            }
            
            .fruit {
                min-width: 70px;
                min-height: 70px;
            }
        }
        
        .fruit {
            touch-action: manipulation;
        }
        
        .game-screen, .fruit, button {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        @media (max-width: 768px) {
            .fruit {
                min-width: 70px;
                min-height: 70px;
            }
            
            button {
                padding: 15px 30px;
                min-height: 50px;
            }
            
            .mode-btn, .difficulty-btn {
                padding: 12px 20px;
                min-width: 80px;
                text-align: center;
            }
        }
        
        @media (max-width: 400px) {
            .game-screen {
                height: 280px;
            }
            
            .current-problem {
                font-size: 1.8rem;
                padding: 10px;
            }
            
            .controls {
                gap: 10px;
            }
            
            button {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .instructions {
                max-height: 150px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 90%;
            }
            
            .game-screen {
                height: 450px;
            }
        }
        /* ç§»åŠ¨ç«¯æ¸¸æˆç»“æŸå¼¹æ¡†æ ·å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .game-over {
                padding: 20px;
                width: 80%;
                max-width: 300px;
            }
            
            .game-over h2 {
                font-size: 1.5rem;
                margin-bottom: 10px;
            }
            
            .game-over p {
                font-size: 1rem;
                margin: 8px 0;
            }
            
            .game-over button {
                padding: 10px 20px;
                font-size: 1rem;
                margin-top: 10px;
            }
        }

        @media (max-width: 400px) {
            .game-over {
                padding: 15px;
                width: 85%;
            }
            
            .game-over h2 {
                font-size: 1.3rem;
            }
        }

        /* ç§»åŠ¨ç«¯æ”¾å¤§çŠ¶æ€ä¸‹æŒ‰é’®ä¼˜åŒ– */
        .mobile.game-enlarged .controls {
            margin: 15px 0;
            gap: 6px; /* è¿›ä¸€æ­¥å‡å°‘é—´è· */
            justify-content: space-between; /* å‡åŒ€åˆ†å¸ƒæŒ‰é’® */
            width: 100%;
            flex-wrap: nowrap; /* ç¡®ä¿ä¸æ¢è¡Œ */
        }

        .mobile.game-enlarged .controls button {
            padding: 12px 15px;
            font-size: 0.95rem;
            min-width: 0; /* ç§»é™¤æœ€å°å®½åº¦é™åˆ¶ */
            transform: none;
            flex: 1; /* å…è®¸æŒ‰é’®ä¼¸ç¼©ä»¥é€‚åº”å®¹å™¨ */
            margin: 0 2px; /* å‡å°‘è¾¹è· */
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mobile.game-enlarged .controls button:hover {
            transform: translateY(-2px);
        }

        /* é’ˆå¯¹å°å±å¹•è®¾å¤‡çš„è¿›ä¸€æ­¥ä¼˜åŒ– */
        @media (max-width: 380px) {
            .mobile.game-enlarged .controls {
                gap: 4px;
            }
            
            .mobile.game-enlarged .controls button {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
        }

        /* é’ˆå¯¹æ¨ªå±æ¨¡å¼çš„ä¼˜åŒ– */
        @media (max-height: 500px) and (orientation: landscape) {
            .mobile.game-enlarged .controls {
                margin: 8px 0;
            }
            
            .mobile.game-enlarged .controls button {
                padding: 8px 10px;
                font-size: 0.85rem;
            }
        }
        
        /* å®‰å“è®¾å¤‡ç‰¹å®šä¼˜åŒ– - ç¡®ä¿æŒ‰é’®åœ¨ä¸€è¡Œ */
        .android.mobile.game-enlarged .controls {
            gap: 5px;
            margin: 12px 0;
        }
        
        .android.mobile.game-enlarged .controls button {
            padding: 10px 12px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 360px) {
            .android.mobile.game-enlarged .controls button {
                padding: 8px 10px;
                font-size: 0.85rem;
            }
        }
        
        /* æ–°å¢ï¼šåˆ‡å¼€åŠ¨ç”» */
        @keyframes cut-left {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
            100% { transform: translate(-20px, -30px) rotate(-20deg); opacity: 0; }
        }
        
        @keyframes cut-right {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
            100% { transform: translate(20px, -30px) rotate(20deg); opacity: 0; }
        }
        
        @keyframes juice-fall {
            0% { transform: translate(0, 0) scale(0.5); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(1.2); opacity: 0; }
        }
        
        @keyframes bomb-explode {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2.5); opacity: 0; }
        }
        
        @keyframes swipe-fade {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .cut-animation-left {
            animation: cut-left 0.8s forwards;
        }
        
        .cut-animation-right {
            animation: cut-right 0.8s forwards;
        }
        
        .bomb-animation {
            animation: bomb-explode 0.5s forwards;
        }
        
        .swipe-fade {
            animation: swipe-fade 0.3s forwards;
        }

        /* æ–°å¢ï¼šé’ˆå¯¹ç§»åŠ¨ç«¯æ”¾å¤§çŠ¶æ€çš„è¿›ä¸€æ­¥ä¼˜åŒ– */
        .mobile.game-enlarged .current-problem {
            margin: 5px 0; /* å‡å°‘ç®—å¼åŒºåŸŸçš„ä¸Šä¸‹è¾¹è· */
            padding: 8px; /* å‡å°‘å†…è¾¹è· */
        }
        
        .mobile.game-enlarged .game-info {
            margin: 8px 0; /* å‡å°‘æ¸¸æˆä¿¡æ¯åŒºåŸŸçš„ä¸Šä¸‹è¾¹è· */
        }
        
        .mobile.game-enlarged .game-screen {
            margin: 3px 0; /* å‡å°‘æ¸¸æˆå±å¹•çš„ä¸Šä¸‹è¾¹è· */
        }

        /* å¹³æ¿æ¨ªå±å¸ƒå±€ä¼˜åŒ– */
        @media (min-width: 768px) and (orientation: landscape) {
            .tablet .selector-container {
                flex-direction: row !important;
                margin: 15px 0;
                gap: 20px;
            }
            
            .tablet .selector {
                flex: 1;
                min-width: 0;
            }
            
            .tablet .game-screen {
                height: 55vh;
                max-height: 450px;
            }
            
            .tablet .instructions {
                max-height: 150px;
            }
        }
        
        /* é’ˆå¯¹å¤§å°ºå¯¸å¹³æ¿çš„è¿›ä¸€æ­¥ä¼˜åŒ– */
        @media (min-width: 1024px) and (orientation: landscape) {
            .tablet .container {
                max-width: 900px;
            }
            
            .tablet .game-screen {
                height: 60vh;
                max-height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ°´æœæ•°å­¦åˆ‡åˆ‡ä¹</h1>
        <div class="subtitle">åˆ‡å¼€æ­£ç¡®ç­”æ¡ˆçš„æ°´æœï¼Œé¿å¼€é”™è¯¯ç­”æ¡ˆ!</div>
        
        <div class="game-info">
            <div class="score">å¾—åˆ†: <span id="score">0</span></div>
            <div class="timer">æ—¶é—´: <span id="timer">60</span>ç§’</div>
            <div class="lives">ç”Ÿå‘½: <span id="lives">3</span></div>
        </div>
        
        <div class="selector-container">
            <div class="selector">
                <h3>é¢˜ç›®ç±»å‹</h3>
                <div class="mode-selector">
                    <div class="mode-btn active" data-mode="addition">åŠ æ³•</div>
                    <div class="mode-btn" data-mode="subtraction">å‡æ³•</div>
                    <div class="mode-btn" data-mode="mixed">æ··åˆ</div>
                </div>
            </div>
            
            <div class="selector">
                <h3>æ¸¸æˆéš¾åº¦</h3>
                <div class="difficulty-selector">
                    <div class="difficulty-btn active" data-difficulty="easy">ç®€å•</div>
                    <div class="difficulty-btn" data-difficulty="medium">ä¸­ç­‰</div>
                    <div class="difficulty-btn" data-difficulty="hard">å›°éš¾</div>
                </div>
            </div>
        </div>
        
        <div class="current-problem" id="currentProblem">
            10 + 5 = ?
        </div>
        
        <div class="game-screen scrollable" id="gameScreen">
            <!-- æ°´æœå°†åŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
            <div class="game-over" id="gameOver">
                <h2>æ¸¸æˆç»“æŸ!</h2>
                <p>æœ€ç»ˆå¾—åˆ†: <span id="finalScore">0</span></p>
                <button class="btn-start" id="restartBtn">å†ç©ä¸€æ¬¡</button>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn-start" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
            <button class="btn-pause" id="pauseBtn">æš‚åœ</button>
            <button class="btn-reset" id="resetBtn">é‡ç½®</button>
        </div>
        
        <div class="instructions">
            <h3>æ¸¸æˆè¯´æ˜:</h3>
            <ul>
                <li>ç‚¹å‡»æˆ–æ»‘åŠ¨åˆ‡å¼€å¸¦æœ‰æ­£ç¡®ç­”æ¡ˆçš„æ°´æœ</li>
                <li>é¿å¼€å¸¦æœ‰é”™è¯¯ç­”æ¡ˆçš„æ°´æœå’Œç‚¸å¼¹</li>
                <li>æ¯ç­”å¯¹ä¸€é¢˜å¾—10åˆ†ï¼Œç­”é”™æˆ–ç¢°åˆ°ç‚¸å¼¹å°†å¤±å»ä¸€æ¡ç”Ÿå‘½</li>
                <li>è¿ç»­ç­”å¯¹ä¼šæœ‰è¿å‡»åŠ åˆ†å“¦!</li>
                <li>æ¸¸æˆæ—¶é—´60ç§’ï¼Œå°½å¯èƒ½è·å¾—é«˜åˆ†å§!</li>
                <li>ç®€å•ï¼šæ°´æœé€Ÿåº¦æ…¢ | ä¸­ç­‰ï¼šæ°´æœé€Ÿåº¦ä¸­ç­‰ | å›°éš¾ï¼šæ°´æœé€Ÿåº¦å¿«</li>
            </ul>
        </div>
    </div>

    <script>
        // æ¸¸æˆå˜é‡
        let score = 0;
        let timeLeft = 60;
        let lives = 3;
        let gameInterval;
        let fruitInterval;
        let isPlaying = false;
        let currentMode = 'addition';
        let currentDifficulty = 'easy';
        let combo = 0;
        let currentExpression = "";
        let currentAnswer = 0;
        // åœ¨æ¸¸æˆå˜é‡éƒ¨åˆ†æ·»åŠ ä»¥ä¸‹å˜é‡
        let correctFruitCount = 0; // è·Ÿè¸ªè¿ç»­éæ­£ç¡®ç­”æ¡ˆçš„æ•°é‡
        let lastWasCorrect = false; // è·Ÿè¸ªä¸Šä¸€ä¸ªæ˜¯å¦æ˜¯æ­£ç¡®ç­”æ¡ˆ
        let isGameEnlarged = false; // è·Ÿè¸ªæ¸¸æˆæ˜¯å¦å¤„äºæ”¾å¤§çŠ¶æ€
        let isProcessingInteraction = false; // é˜²æ­¢é‡å¤å¤„ç†äº¤äº’
        
        // æ»‘åŠ¨æ‰‹åŠ¿ç›¸å…³å˜é‡
        let isSwipeActive = false;
        let swipeStartX = 0;
        let swipeStartY = 0;
        let swipePoints = []; // å­˜å‚¨æ»‘åŠ¨è·¯å¾„ç‚¹
        let swipeFruitsCut = new Set(); // å­˜å‚¨æœ¬æ¬¡æ»‘åŠ¨å·²åˆ‡å‰²çš„æ°´æœ

        // éŸ³é¢‘ä¸Šä¸‹æ–‡
        let audioContext = null;
        let audioInitialized = false;
        
        // æ£€æµ‹è®¾å¤‡ç±»å‹
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        const isAndroid = /Android/i.test(navigator.userAgent);
        const isMobile = isIOS || isAndroid;
        // æ–°å¢ï¼šæ£€æµ‹æ˜¯å¦ä¸ºå¹³æ¿è®¾å¤‡
        const isTablet = /iPad|Android|Tablet|PlayBook|Silk|KFAPWI/i.test(navigator.userAgent) || 
                        (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1) ||
                        (window.innerWidth >= 768 && window.innerHeight >= 1024);
        
        // éš¾åº¦é…ç½®
        const difficultySettings = {
            easy: { fruitInterval: 1200, animationDuration: { min: 4, max: 6 } },
            medium: { fruitInterval: 800, animationDuration: { min: 3, max: 5 } },
            hard: { fruitInterval: 500, animationDuration: { min: 2, max: 4 } }
        };
        
        // DOMå…ƒç´ 
        const gameScreen = document.getElementById('gameScreen');
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');
        const livesElement = document.getElementById('lives');
        const currentProblemElement = document.getElementById('currentProblem');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const modeButtons = document.querySelectorAll('.mode-btn');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        const gameOverScreen = document.getElementById('gameOver');
        const finalScoreElement = document.getElementById('finalScore');
        const restartBtn = document.getElementById('restartBtn');
        const container = document.querySelector('.container');
        const body = document.body;
        
        // å¦‚æœæ˜¯ç§»åŠ¨è®¾å¤‡ï¼Œç»™bodyå’Œcontaineræ·»åŠ mobileç±»
        if (isMobile) {
            body.classList.add('mobile');
            container.classList.add('mobile');
        }
        
        // å¦‚æœæ˜¯å¹³æ¿è®¾å¤‡ï¼Œæ·»åŠ tabletç±»
        if (isTablet) {
            body.classList.add('tablet');
            container.classList.add('tablet');
        }
        
        // å¦‚æœæ˜¯å®‰å“è®¾å¤‡ï¼Œæ·»åŠ androidç±»
        if (isAndroid) {
            body.classList.add('android');
        }
        
        // å¦‚æœæ˜¯iOSè®¾å¤‡ï¼Œæ·»åŠ iosç±»
        if (isIOS) {
            body.classList.add('ios');
        }
        
        // æ°´æœæ ·å¼é…ç½®
        const fruitStyles = [
            { background: 'linear-gradient(to bottom, #ff5e5e, #ff2121)', color: 'white', type: 'apple', width: 70 },
            { background: 'linear-gradient(to bottom, #ffeb3b, #ffc107)', color: '#333', type: 'lemon', width: 65 },
            { background: 'linear-gradient(to bottom, #4caf50, #2e7d32)', color: 'white', type: 'watermelon', width: 80 },
            { background: 'linear-gradient(to bottom, #ff9800, #f57c00)', color: 'white', type: 'orange', width: 70 },
            { background: 'linear-gradient(to bottom, #e91e63, #ad1457)', color: 'white', type: 'strawberry', width: 60 },
            { background: 'linear-gradient(to bottom, #9c27b0, #6a1b9a)', color: 'white', type: 'grape', width: 55 }
        ];
        
        // åˆå§‹åŒ–éŸ³é¢‘
        function initAudio() {
            if (audioInitialized) return audioContext;
            
            try {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                if (window.AudioContext) {
                    audioContext = new AudioContext();
                    
                    // å®‰å“è®¾å¤‡éœ€è¦ç”¨æˆ·äº¤äº’åæ‰èƒ½æ’­æ”¾éŸ³é¢‘
                    const resumeAudio = function() {
                        if (audioContext && audioContext.state === 'suspended') {
                            audioContext.resume().then(() => {
                                console.log('AudioContext resumed successfully');
                            });
                        }
                        document.removeEventListener('click', resumeAudio);
                        document.removeEventListener('touchstart', resumeAudio);
                    };
                    
                    document.addEventListener('click', resumeAudio);
                    document.addEventListener('touchstart', resumeAudio);
                    
                    audioInitialized = true;
                    return audioContext;
                }
            } catch (e) {
                console.error('Web Audio API is not supported in this browser', e);
            }
            return null;
        }
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(frequency, type, duration) {
            // ç¡®ä¿éŸ³é¢‘ä¸Šä¸‹æ–‡å·²åˆå§‹åŒ–
            if (!audioInitialized) {
                initAudio();
            }
            
            if (!audioContext) return;
            
            // æ£€æŸ¥éŸ³é¢‘ä¸Šä¸‹æ–‡çŠ¶æ€ï¼Œå¦‚æœæ˜¯æš‚åœçŠ¶æ€åˆ™å°è¯•æ¢å¤
            if (audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    actuallyPlaySound(frequency, type, duration);
                }).catch(error => {
                    console.error('Failed to resume audio context:', error);
                });
            } else {
                actuallyPlaySound(frequency, type, duration);
            }
        }
        
        // å®é™…æ’­æ”¾å£°éŸ³çš„å‡½æ•°
        function actuallyPlaySound(frequency, type, duration) {
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = type;
                oscillator.frequency.value = frequency;
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (error) {
                console.error('Error playing sound:', error);
            }
        }
        
        // ç”Ÿæˆæ•°å­¦é¢˜ç›®
        function generateProblem() {
            let num1, num2;
            
            if (currentMode === 'addition' || (currentMode === 'mixed' && Math.random() > 0.5)) {
                // åŠ æ³•é¢˜
                num1 = Math.floor(Math.random() * 50) + 1;
                num2 = Math.floor(Math.random() * 50) + 1;
                currentAnswer = num1 + num2;
                currentExpression = `${num1} + ${num2}`;
            } else {
                // å‡æ³•é¢˜ï¼ˆç¡®ä¿ç»“æœä¸ä¸ºè´Ÿæ•°ï¼‰
                num2 = Math.floor(Math.random() * 50) + 1;
                num1 = Math.floor(Math.random() * 50) + num2;
                currentAnswer = num1 - num2;
                currentExpression = `${num1} - ${num2}`;
            }
            
            // æ›´æ–°é¢˜ç›®æ˜¾ç¤º
            currentProblemElement.textContent = `${currentExpression} = ?`;
            
            // ç”Ÿæˆæ–°é¢˜ç›®æ—¶é‡ç½®è®¡æ•°å™¨
            correctFruitCount = 0;
            lastWasCorrect = false;
            
            return { expression: currentExpression, answer: currentAnswer };
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            score = 0;
            timeLeft = 60;
            lives = 3;
            combo = 0;
            correctFruitCount = 0; // é‡ç½®è®¡æ•°å™¨
            lastWasCorrect = false; // é‡ç½®æ ‡å¿—
            updateUI();
            gameOverScreen.style.display = 'none';
            
            // ç”Ÿæˆç¬¬ä¸€ä¸ªé¢˜ç›®
            generateProblem();
            
            // æ¸…é™¤ä»»ä½•å¯èƒ½å­˜åœ¨çš„æ°´æœ
            const fruits = document.querySelectorAll('.fruit');
            fruits.forEach(fruit => fruit.remove());
            
            // åªåœ¨é‡ç½®æŒ‰é’®è¢«ç‚¹å‡»æ—¶æ¢å¤æ¸¸æˆç•Œé¢å¤§å°
            if (!isGameEnlarged) {
                shrinkGameInterface();
            }
            
            // æ¸¸æˆåˆå§‹åŒ–æ—¶å…è®¸gameScreenæ»šåŠ¨
            gameScreen.classList.add('scrollable');
        }
        
        // æ”¾å¤§æ¸¸æˆç•Œé¢
        function enlargeGameInterface() {
            // ä¿®æ”¹ï¼šç§»é™¤å¹³æ¿æ£€æµ‹é™åˆ¶ï¼Œå¯¹æ‰€æœ‰ç§»åŠ¨è®¾å¤‡åº”ç”¨æ”¾å¤§
            if (isMobile) {
                body.classList.add('game-enlarged');
                container.classList.add('game-enlarged');
                isGameEnlarged = true;
                
                // å®‰å“è®¾å¤‡ç‰¹å®šä¼˜åŒ–ï¼šå¼ºåˆ¶é‡ç»˜ä»¥è§£å†³æ¸²æŸ“é—®é¢˜
                if (isAndroid) {
                    void container.offsetHeight; // è§¦å‘é‡ç»˜
                }
            }
        }
        
        // ç¼©å°æ¸¸æˆç•Œé¢
        function shrinkGameInterface() {
            body.classList.remove('game-enlarged');
            container.classList.remove('game-enlarged');
            isGameEnlarged = false;
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (isPlaying) return;
            
            isPlaying = true;
            startBtn.disabled = true;
            
            // ç§»é™¤å¯æ»šåŠ¨ç±»ï¼Œç¦æ­¢gameScreenæ»šåŠ¨
            gameScreen.classList.remove('scrollable');
            
            // æ”¾å¤§æ¸¸æˆç•Œé¢
            enlargeGameInterface();
            
            // åˆå§‹åŒ–éŸ³é¢‘
            initAudio();
            
            // æ¸¸æˆè®¡æ—¶å™¨
            gameInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
            
            // æ ¹æ®éš¾åº¦è®¾ç½®æ°´æœç”Ÿæˆé—´éš”
            const fruitIntervalTime = difficultySettings[currentDifficulty].fruitInterval;
            fruitInterval = setInterval(createFruit, fruitIntervalTime);
        }
        
        // æš‚åœæ¸¸æˆ
        function pauseGame() {
            if (!isPlaying) return;
            
            isPlaying = false;
            startBtn.disabled = false;
            clearInterval(gameInterval);
            clearInterval(fruitInterval);
            
            // æš‚åœæ‰€æœ‰æ°´æœçš„åŠ¨ç”»
            const fruits = document.querySelectorAll('.fruit');
            fruits.forEach(fruit => {
                fruit.style.animationPlayState = 'paused';
            });
            
            // æ¸¸æˆæš‚åœæ—¶æ¢å¤gameScreenæ»šåŠ¨
            gameScreen.classList.add('scrollable');
            
            // æ¸¸æˆæš‚åœæ—¶æ¢å¤é¡µé¢æ»šåŠ¨
            document.body.style.overflow = 'auto';
        }
        
        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            pauseGame();
            initGame();
            // é‡ç½®æ—¶æ€»æ˜¯ç¼©å°ç•Œé¢
            shrinkGameInterface();
        }
        
        // åˆ›å»ºæ°´æœ
        function createFruit() {
            if (!isPlaying) return;
            
            const screenWidth = gameScreen.offsetWidth;
            const fruitSize = Math.floor(Math.random() * 20) + 60; // 60-80px
            
            // éšæœºé€‰æ‹©æ°´æœæ ·å¼
            const style = fruitStyles[Math.floor(Math.random() * fruitStyles.length)];
            
            // åˆ›å»ºæ°´æœå…ƒç´ 
            const fruit = document.createElement('div');
            fruit.className = 'fruit';
            fruit.style.width = `${fruitSize}px`;
            fruit.style.height = `${fruitSize}px`;
            fruit.style.background = style.background;
            fruit.style.color = style.color;
            fruit.style.fontSize = `${fruitSize / 3}px`;
            fruit.style.top = '-80px';
            fruit.style.left = `${Math.random() * (screenWidth - fruitSize)}px`;
            
            // å†³å®šè¿™ä¸ªæ°´æœæ˜¯æ­£ç¡®ç­”æ¡ˆè¿˜æ˜¯é”™è¯¯ç­”æ¡ˆï¼ˆ20%å‡ ç‡æ˜¯ç‚¸å¼¹ï¼‰
            let isBomb = false;
            let displayText;
            
            // æ›¿æ¢åŸæœ‰çš„å†³å®šæ°´æœæ˜¯æ­£ç¡®ç­”æ¡ˆè¿˜æ˜¯é”™è¯¯ç­”æ¡ˆçš„é€»è¾‘
            if (Math.random() < 0.2) {
                // ç‚¸å¼¹æ°´æœ
                isBomb = true;
                displayText = 'ğŸ’£';
                fruit.dataset.isBomb = true;
                correctFruitCount++; // ç‚¸å¼¹ä¹Ÿç®—ä½œéæ­£ç¡®ç­”æ¡ˆè®¡æ•°
            } else {
                // ç¡®ä¿è¿ç»­4ä¸ªæ°´æœå†…å¿…æœ‰ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆï¼Œä¸”ä¸ä¼šæœ‰ä¸¤ä¸ªæ­£ç¡®ç­”æ¡ˆ
                if (correctFruitCount >= 3 || (lastWasCorrect && correctFruitCount >= 2)) {
                    // æ­£ç¡®ç­”æ¡ˆ
                    displayText = currentAnswer;
                    fruit.dataset.correct = true;
                    correctFruitCount = 0;
                    lastWasCorrect = true;
                    // æ·»åŠ è§†è§‰æç¤º
                    fruit.style.boxShadow = '0 0 15px 5px #4caf50';
                } else {
                    // 50%å‡ ç‡æ­£ç¡®ç­”æ¡ˆï¼Œ50%é”™è¯¯ç­”æ¡ˆ
                    if (Math.random() < 0.5 && !lastWasCorrect) {
                        // æ­£ç¡®ç­”æ¡ˆ
                        displayText = currentAnswer;
                        fruit.dataset.correct = true;
                        correctFruitCount = 0;
                        lastWasCorrect = true;
                        // æ·»åŠ è§†è§‰æç¤º
                        fruit.style.boxShadow = '0 0 15px 5px #4caf50';
                    } else {
                        // é”™è¯¯ç­”æ¡ˆï¼ˆç”Ÿæˆæ¥è¿‘æ­£ç¡®ç­”æ¡ˆçš„å¹²æ‰°é¡¹ï¼‰
                        let wrongAnswer;
                        if (Math.random() < 0.5) {
                            wrongAnswer = currentAnswer + Math.floor(Math.random() * 5) + 1;
                        } else {
                            wrongAnswer = currentAnswer - Math.floor(Math.random() * 5) - 1;
                        }
                        // ç¡®ä¿é”™è¯¯ç­”æ¡ˆä¸ä¸ºè´Ÿæ•°
                        wrongAnswer = Math.max(0, wrongAnswer);
                        displayText = wrongAnswer;
                        fruit.dataset.correct = false;
                        correctFruitCount++;
                        lastWasCorrect = false;
                    }
                }
            }
            
            fruit.textContent = displayText;
            
            // æ ¹æ®éš¾åº¦è®¾ç½®åŠ¨ç”»é€Ÿåº¦
            const animDuration = difficultySettings[currentDifficulty].animationDuration;
            const animationDuration = Math.random() * (animDuration.max - animDuration.min) + animDuration.min;
            fruit.style.animation = `fall ${animationDuration}s linear`;
            
            // æ·»åŠ åˆ°æ¸¸æˆå±å¹•
            gameScreen.appendChild(fruit);
            
            // æ°´æœç‚¹å‡»äº‹ä»¶
            fruit.addEventListener('click', () => {
                handleFruitInteraction(fruit);
            });
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤æ°´æœ
            setTimeout(() => {
                if (fruit.parentNode && !fruit.dataset.cut) {
                    fruit.remove();
                }
            }, animationDuration * 1000);
        }
        
        // å¤„ç†æ°´æœäº¤äº’ï¼ˆç‚¹å‡»æˆ–æ»‘åŠ¨ï¼‰
        function handleFruitInteraction(fruit) {
            if (!isPlaying || fruit.dataset.cut || isProcessingInteraction) return;
            
            // è®¾ç½®å¤„ç†ä¸­æ ‡å¿—ï¼Œé˜²æ­¢é‡å¤å¤„ç†
            isProcessingInteraction = true;
            
            // æ ‡è®°ä¸ºå·²åˆ‡å‰²ï¼Œé˜²æ­¢é‡å¤åˆ‡å‰²
            fruit.dataset.cut = true;
            
            // è·å–æ°´æœä½ç½®
            const rect = fruit.getBoundingClientRect();
            const gameScreenRect = gameScreen.getBoundingClientRect();
            const x = rect.left - gameScreenRect.left;
            const y = rect.top - gameScreenRect.top;
            
            if (fruit.dataset.isBomb) {
                // ç‚¹å‡»äº†ç‚¸å¼¹ - æ‰€æœ‰è®¾å¤‡éƒ½åªæ‰£1åˆ†
                createBombEffect(fruit, x, y);
                lives--;
                playSound(130.81, 'square', 0.7); // ç‚¸å¼¹éŸ³æ•ˆ
                updateUI();
                combo = 0;
                checkGameOver();
            } else if (fruit.dataset.correct === 'true') {
                // ç‚¹å‡»äº†æ­£ç¡®ç­”æ¡ˆ
                createCutEffect(fruit, x, y, '#4caf50');
                score += 10;
                combo++;
                
                // è¿å‡»å¥–åŠ±
                if (combo >= 3) {
                    score += Math.floor(combo / 3) * 5;
                }
                
                playSound(783.99, 'triangle', 0.3); // æ­£ç¡®éŸ³æ•ˆ
                updateUI();
                
                // ç­”å¯¹åç”Ÿæˆæ–°é¢˜ç›®
                generateProblem();
            } else {
                // ç‚¹å‡»äº†é”™è¯¯ç­”æ¡ˆ
                createCutEffect(fruit, x, y, '#ff9800');
                lives--;
                playSound(196.00, 'square', 0.5); // é”™è¯¯éŸ³æ•ˆ
                updateUI();
                combo = 0;
                checkGameOver();
            }
            
            // åŠ¨ç”»æ’­æ”¾å®Œåç§»é™¤æ°´æœ
            setTimeout(() => {
                if (fruit.parentNode) {
                    fruit.remove();
                }
                // é‡ç½®å¤„ç†ä¸­æ ‡å¿—
                isProcessingInteraction = false;
            }, 800);
        }
        
        // åˆ›å»ºåˆ‡å¼€æ•ˆæœ
        function createCutEffect(fruit, x, y, color) {
            const fruitSize = parseInt(fruit.style.width);
            const value = fruit.textContent;
            const background = fruit.style.background;
            const textColor = fruit.style.color;
            
            // éšè—åŸæ°´æœ
            fruit.style.visibility = 'hidden';
            
            // åˆ›å»ºå·¦åŠéƒ¨åˆ†
            const leftHalf = document.createElement('div');
            leftHalf.className = 'fruit-half left';
            leftHalf.style.background = background;
            leftHalf.style.color = textColor;
            leftHalf.style.width = `${fruitSize/2}px`;
            leftHalf.style.height = `${fruitSize}px`;
            leftHalf.style.left = `${x}px`;
            leftHalf.style.top = `${y}px`;
            leftHalf.style.fontSize = fruit.style.fontSize;
            
            const leftInner = document.createElement('div');
            leftInner.className = 'fruit-half-inner';
            leftInner.style.background = background;
            leftInner.style.color = textColor;
            leftInner.style.width = `${fruitSize}px`;
            leftInner.style.height = `${fruitSize}px`;
            leftInner.textContent = value;
            leftHalf.appendChild(leftInner);
            
            // åˆ›å»ºå³åŠéƒ¨åˆ†
            const rightHalf = document.createElement('div');
            rightHalf.className = 'fruit-half right';
            rightHalf.style.background = background;
            rightHalf.style.color = textColor;
            rightHalf.style.width = `${fruitSize/2}px`;
            rightHalf.style.height = `${fruitSize}px`;
            rightHalf.style.left = `${x + fruitSize/2}px`;
            rightHalf.style.top = `${y}px`;
            rightHalf.style.fontSize = fruit.style.fontSize;
            
            const rightInner = document.createElement('div');
            rightInner.className = 'fruit-half-inner';
            rightInner.style.background = background;
            rightInner.style.color = textColor;
            rightInner.style.width = `${fruitSize}px`;
            rightInner.style.height = `${fruitSize}px`;
            rightInner.textContent = value;
            rightHalf.appendChild(rightInner);
            
            // æ·»åŠ åˆ°æ¸¸æˆå±å¹•
            gameScreen.appendChild(leftHalf);
            gameScreen.appendChild(rightHalf);
            
            // åº”ç”¨åŠ¨ç”»
            setTimeout(() => {
                leftHalf.style.animation = 'cut-left 0.8s forwards';
                rightHalf.style.animation = 'cut-right 0.8s forwards';
                
                // åˆ›å»ºæœæ±é£æº…æ•ˆæœ
                createEnhancedJuiceEffect(x + fruitSize/2, y + fruitSize/2, color);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    leftHalf.remove();
                    rightHalf.remove();
                }, 800);
            }, 10);
        }
        
        // åˆ›å»ºç‚¸å¼¹çˆ†ç‚¸æ•ˆæœ
        function createBombEffect(fruit, x, y) {
            const fruitSize = parseInt(fruit.style.width);
            
            // éšè—åŸæ°´æœ
            fruit.style.visibility = 'hidden';
            
            // åˆ›å»ºç‚¸å¼¹çˆ†ç‚¸æ•ˆæœ
            const bombEffect = document.createElement('div');
            bombEffect.className = 'fruit';
            bombEffect.style.background = 'radial-gradient(circle, #ff0000, #ff8800, #ff0000)';
            bombEffect.style.color = 'white';
            bombEffect.style.width = `${fruitSize}px`;
            bombEffect.style.height = `${fruitSize}px`;
            bombEffect.style.left = `${x}px`;
            bombEffect.style.top = `${y}px`;
            bombEffect.style.fontSize = fruit.style.fontSize;
            bombEffect.textContent = 'ğŸ’¥';
            bombEffect.style.zIndex = '20';
            bombEffect.style.display = 'flex';
            bombEffect.style.justifyContent = 'center';
            bombEffect.style.alignItems = 'center';
            
            gameScreen.appendChild(bombEffect);
            
            // åº”ç”¨çˆ†ç‚¸åŠ¨ç”»
            setTimeout(() => {
                bombEffect.style.animation = 'bomb-explode 0.5s forwards';
                
                // åˆ›å»ºçˆ†ç‚¸ç¢ç‰‡æ•ˆæœ
                createExplosionEffect(x + fruitSize/2, y + fruitSize/2);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    bombEffect.remove();
                }, 500);
            }, 10);
        }
        
        // åˆ›å»ºå¢å¼ºç‰ˆæœæ±é£æº…æ•ˆæœ
        function createEnhancedJuiceEffect(x, y, color) {
            // åˆ›å»ºå¤šä¸ªæœæ±æ»´
            for (let i = 0; i < 8; i++) {
                const drop = document.createElement('div');
                drop.className = 'juice-drop';
                drop.style.background = color;
                drop.style.width = `${8 + Math.random() * 12}px`;
                drop.style.height = `${8 + Math.random() * 12}px`;
                drop.style.left = `${x}px`;
                drop.style.top = `${y}px`;
                
                // éšæœºè®¾ç½®åŠ¨ç”»å‚æ•°
                const angle = Math.random() * Math.PI * 2;
                const distance = 30 + Math.random() * 50;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                drop.style.setProperty('--tx', `${tx}px`);
                drop.style.setProperty('--ty', `${ty}px`);
                drop.style.animation = `juice-fall 0.8s forwards`;
                
                gameScreen.appendChild(drop);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤
                setTimeout(() => {
                    drop.remove();
                }, 800);
            }
        }
        
        // åˆ›å»ºçˆ†ç‚¸ç¢ç‰‡æ•ˆæœ
        function createExplosionEffect(x, y) {
            // åˆ›å»ºå¤šä¸ªçˆ†ç‚¸ç¢ç‰‡
            for (let i = 0; i < 12; i++) {
                const fragment = document.createElement('div');
                fragment.className = 'juice-drop';
                fragment.style.background = i % 2 === 0 ? '#ff0000' : '#ff8800';
                fragment.style.width = `${5 + Math.random() * 10}px`;
                fragment.style.height = `${5 + Math.random() * 10}px`;
                fragment.style.left = `${x}px`;
                fragment.style.top = `${y}px`;
                
                // éšæœºè®¾ç½®åŠ¨ç”»å‚æ•°
                const angle = Math.random() * Math.PI * 2;
                const distance = 40 + Math.random() * 60;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                fragment.style.setProperty('--tx', `${tx}px`);
                fragment.style.setProperty('--ty', `${ty}px`);
                fragment.style.animation = `juice-fall 0.5s forwards`;
                
                gameScreen.appendChild(fragment);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤
                setTimeout(() => {
                    fragment.remove();
                }, 500);
            }
        }
        
        // åˆ›å»ºåˆ€å…‰æ•ˆæœ
        function createSwipeEffect(x1, y1, x2, y2) {
            const dx = x2 - x1;
            const dy = y2 - y1;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            const swipe = document.createElement('div');
            swipe.className = 'swipe-effect';
            swipe.style.width = `${length}px`;
            swipe.style.left = `${x1}px`;
            swipe.style.top = `${y1}px`;
            swipe.style.transform = `rotate(${angle}deg)`;
            swipe.style.opacity = '1';
            
            gameScreen.appendChild(swipe);
            
            // æ·»åŠ æ·¡å‡ºåŠ¨ç”»
            swipe.style.animation = 'swipe-fade 0.3s forwards';
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤
            setTimeout(() => {
                swipe.remove();
            }, 300);
        }
        
        // æ£€æµ‹ç‚¹æ˜¯å¦åœ¨æ°´æœå†…
        function isPointInFruit(x, y, fruit) {
            const rect = fruit.getBoundingClientRect();
            const gameScreenRect = gameScreen.getBoundingClientRect();
            
            // è½¬æ¢ä¸ºç›¸å¯¹äºæ¸¸æˆåŒºåŸŸçš„åæ ‡
            const fruitX = rect.left - gameScreenRect.left;
            const fruitY = rect.top - gameScreenRect.top;
            const fruitSize = parseInt(fruit.style.width);
            
            // è®¡ç®—ç‚¹åˆ°æ°´æœä¸­å¿ƒçš„è·ç¦»
            const centerX = fruitX + fruitSize / 2;
            const centerY = fruitY + fruitSize / 2;
            const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
            
            // å¦‚æœè·ç¦»å°äºæ°´æœåŠå¾„ï¼Œåˆ™åœ¨æ°´æœå†…
            return distance <= fruitSize / 2;
        }
        
        // æ£€æµ‹çº¿æ®µä¸æ°´æœçš„äº¤é›† - ä¼˜åŒ–ç‰ˆæœ¬
        function checkSwipeFruitIntersection(x1, y1, x2, y2) {
            const fruits = document.querySelectorAll('.fruit:not([data-cut])');
            
            // è®¡ç®—æ»‘åŠ¨è·¯å¾„çš„çŸ©å½¢èŒƒå›´
            const minX = Math.min(x1, x2);
            const maxX = Math.max(x1, x2);
            const minY = Math.min(y1, y2);
            const maxY = Math.max(y1, y2);
            
            // æ‰©å¤§çŸ©å½¢èŒƒå›´ï¼ŒåŒ…å«å¯èƒ½è¢«åˆ‡å‰²çš„æ°´æœ
            const expandedMinX = minX - 50;
            const expandedMaxX = maxX + 50;
            const expandedMinY = minY - 50;
            const expandedMaxY = maxY + 50;
            
            for (const fruit of fruits) {
                // å¦‚æœè¿™ä¸ªæ°´æœå·²ç»åœ¨æœ¬æ¬¡æ»‘åŠ¨ä¸­è¢«åˆ‡å‰²è¿‡ï¼Œè·³è¿‡
                if (swipeFruitsCut.has(fruit)) continue;
                
                const rect = fruit.getBoundingClientRect();
                const gameScreenRect = gameScreen.getBoundingClientRect();
                
                // è½¬æ¢ä¸ºç›¸å¯¹äºæ¸¸æˆåŒºåŸŸçš„åæ ‡
                const fruitX = rect.left - gameScreenRect.left;
                const fruitY = rect.top - gameScreenRect.top;
                const fruitSize = parseInt(fruit.style.width);
                
                // æ°´æœçš„ä¸­å¿ƒç‚¹
                const centerX = fruitX + fruitSize / 2;
                const centerY = fruitY + fruitSize / 2;
                
                // é¦–å…ˆè¿›è¡Œç²—ç•¥æ£€æµ‹ï¼šæ°´æœä¸­å¿ƒæ˜¯å¦åœ¨æ‰©å¤§åçš„çŸ©å½¢èŒƒå›´å†…
                if (centerX < expandedMinX || centerX > expandedMaxX || 
                    centerY < expandedMinY || centerY > expandedMaxY) {
                    continue; // æ°´æœä¸åœ¨æ»‘åŠ¨è·¯å¾„é™„è¿‘ï¼Œè·³è¿‡
                }
                
                // ç²¾ç¡®æ£€æµ‹ï¼šè®¡ç®—çº¿æ®µä¸åœ†çš„äº¤ç‚¹
                const radius = fruitSize / 2;
                const dx = x2 - x1;
                const dy = y2 - y1;
                const a = dx * dx + dy * dy;
                const b = 2 * (dx * (x1 - centerX) + dy * (y1 - centerY));
                const c = (x1 - centerX) * (x1 - centerX) + (y1 - centerY) * (y1 - centerY) - radius * radius;
                
                const discriminant = b * b - 4 * a * c;
                
                if (discriminant >= 0) {
                    // çº¿æ®µä¸åœ†æœ‰äº¤ç‚¹ï¼Œå¤„ç†æ°´æœåˆ‡å‰²
                    swipeFruitsCut.add(fruit);
                    handleFruitInteraction(fruit);
                }
            }
        }
        
        // å¤„ç†æ»‘åŠ¨æ‰‹åŠ¿
        function handleSwipeGesture(startX, startY, endX, endY) {
            // åˆ›å»ºåˆ€å…‰æ•ˆæœ
            createSwipeEffect(startX, startY, endX, endY);
            
            // æ£€æµ‹æ»‘åŠ¨è·¯å¾„ä¸æ°´æœçš„äº¤é›†
            checkSwipeFruitIntersection(startX, startY, endX, endY);
        }
        
        // æ›´æ–°UI
        function updateUI() {
            scoreElement.textContent = score;
            timerElement.textContent = timeLeft;
            livesElement.textContent = lives;
        }
        
        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
        function checkGameOver() {
            if (lives <= 0) {
                endGame();
            }
        }
        
        // ç»“æŸæ¸¸æˆ
        function endGame() {
            pauseGame();
            finalScoreElement.textContent = score;
            gameOverScreen.style.display = 'block';
            
            // æ¸¸æˆç»“æŸæ—¶ç¼©å°ç•Œé¢
            shrinkGameInterface();
        }
        
        // æ·»åŠ CSSåŠ¨ç”»
        const styleSheet = document.createElement('style');
        styleSheet.innerHTML = `
            @keyframes fall {
                from { transform: translateY(0); }
                to { transform: translateY(480px); }
            }
            
            @keyframes expand {
                from { transform: scale(0); opacity: 0.8; }
                to { transform: scale(1.5); opacity: 0; }
            }
            
            /* ä¸ºæ”¾å¤§çŠ¶æ€æ·»åŠ æ–°çš„æ‰è½åŠ¨ç”» */
            .mobile.game-enlarged .game-screen {
                overflow: hidden;
            }
            
            .mobile.game-enlarged @keyframes fall {
                from { transform: translateY(0); }
                to { transform: translateY(100%); }
            }
        `;
        document.head.appendChild(styleSheet);
        
        // äº‹ä»¶ç›‘å¬å™¨
        startBtn.addEventListener('click', startGame);
        pauseBtn.addEventListener('click', pauseGame);
        resetBtn.addEventListener('click', resetGame);
        
        // æ¨¡å¼é€‰æ‹©
        modeButtons.forEach(button => {
            button.addEventListener('click', () => {
                modeButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentMode = button.dataset.mode;
                
                // åˆ‡æ¢æ¨¡å¼æ—¶ç”Ÿæˆæ–°é¢˜ç›®
                if (isPlaying) {
                    generateProblem();
                }
            });
        });
        
        // éš¾åº¦é€‰æ‹©
        difficultyButtons.forEach(button => {
            button.addEventListener('click', () => {
                difficultyButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentDifficulty = button.dataset.difficulty;
                
                // å¦‚æœæ¸¸æˆæ­£åœ¨è¿›è¡Œä¸­ï¼Œé‡æ–°è®¾ç½®æ°´æœç”Ÿæˆé—´éš”
                if (isPlaying) {
                    clearInterval(fruitInterval);
                    const fruitIntervalTime = difficultySettings[currentDifficulty].fruitInterval;
                    fruitInterval = setInterval(createFruit, fruitIntervalTime);
                }
            });
        });

        // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
        function addTouchSupport() {
            const gameScreen = document.getElementById('gameScreen');
            
            // ç›‘å¬è§¦æ‘¸äº‹ä»¶ - åªåœ¨æ¸¸æˆè¿›è¡Œä¸­é˜»æ­¢é»˜è®¤è¡Œä¸º
            gameScreen.addEventListener('touchstart', function(e) {
                if (isPlaying) {
                    isSwipeActive = true;
                    swipePoints = [];
                    swipeFruitsCut.clear();
                    
                    const touch = e.touches[0];
                    const rect = gameScreen.getBoundingClientRect();
                    swipeStartX = touch.clientX - rect.left;
                    swipeStartY = touch.clientY - rect.top;
                    
                    swipePoints.push({ x: swipeStartX, y: swipeStartY });
                    e.preventDefault();
                }
            }, { passive: false });
            
            gameScreen.addEventListener('touchmove', function(e) {
                if (isPlaying && isSwipeActive) {
                    const touch = e.touches[0];
                    const rect = gameScreen.getBoundingClientRect();
                    const currentX = touch.clientX - rect.left;
                    const currentY = touch.clientY - rect.top;
                    
                    // è®°å½•æ»‘åŠ¨ç‚¹
                    swipePoints.push({ x: currentX, y: currentY });
                    
                    // æ¯ç§»åŠ¨ä¸€å®šè·ç¦»æ£€æµ‹ä¸€æ¬¡æ°´æœåˆ‡å‰²
                    if (swipePoints.length >= 2) {
                        const lastPoint = swipePoints[swipePoints.length - 2];
                        const currentPoint = swipePoints[swipePoints.length - 1];
                        
                        // æ£€æµ‹æ»‘åŠ¨è·¯å¾„ä¸æ°´æœçš„äº¤é›†
                        checkSwipeFruitIntersection(lastPoint.x, lastPoint.y, currentPoint.x, currentPoint.y);
                        
                        // åˆ›å»ºåˆ€å…‰æ•ˆæœ
                        createSwipeEffect(lastPoint.x, lastPoint.y, currentPoint.x, currentPoint.y);
                    }
                    
                    e.preventDefault();
                }
            }, { passive: false });
            
            gameScreen.addEventListener('touchend', function(e) {
                if (isPlaying && isSwipeActive) {
                    isSwipeActive = false;
                    
                    if (swipePoints.length > 1) {
                        const lastPoint = swipePoints[swipePoints.length - 1];
                        handleSwipeGesture(swipeStartX, swipeStartY, lastPoint.x, lastPoint.y);
                    }
                    
                    e.preventDefault();
                }
            }, { passive: false });
            
            // é¼ æ ‡äº‹ä»¶æ”¯æŒï¼ˆç”¨äºæ¡Œé¢è®¾å¤‡ï¼‰
            gameScreen.addEventListener('mousedown', function(e) {
                if (isPlaying) {
                    isSwipeActive = true;
                    swipePoints = [];
                    swipeFruitsCut.clear();
                    
                    const rect = gameScreen.getBoundingClientRect();
                    swipeStartX = e.clientX - rect.left;
                    swipeStartY = e.clientY - rect.top;
                    
                    swipePoints.push({ x: swipeStartX, y: swipeStartY });
                    e.preventDefault();
                }
            });
            
            gameScreen.addEventListener('mousemove', function(e) {
                if (isPlaying && isSwipeActive) {
                    const rect = gameScreen.getBoundingClientRect();
                    const currentX = e.clientX - rect.left;
                    const currentY = e.clientY - rect.top;
                    
                    // è®°å½•æ»‘åŠ¨ç‚¹
                    swipePoints.push({ x: currentX, y: currentY });
                    
                    // æ¯ç§»åŠ¨ä¸€å®šè·ç¦»æ£€æµ‹ä¸€æ¬¡æ°´æœåˆ‡å‰²
                    if (swipePoints.length >= 2) {
                        const lastPoint = swipePoints[swipePoints.length - 2];
                        const currentPoint = swipePoints[swipePoints.length - 1];
                        
                        // æ£€æµ‹æ»‘åŠ¨è·¯å¾„ä¸æ°´æœçš„äº¤é›†
                        checkSwipeFruitIntersection(lastPoint.x, lastPoint.y, currentPoint.x, currentPoint.y);
                        
                        // åˆ›å»ºåˆ€å…‰æ•ˆæœ
                        createSwipeEffect(lastPoint.x, lastPoint.y, currentPoint.x, currentPoint.y);
                    }
                    
                    e.preventDefault();
                }
            });
            
            gameScreen.addEventListener('mouseup', function(e) {
                if (isPlaying && isSwipeActive) {
                    isSwipeActive = false;
                    
                    if (swipePoints.length > 1) {
                        const lastPoint = swipePoints[swipePoints.length - 1];
                        handleSwipeGesture(swipeStartX, swipeStartY, lastPoint.x, lastPoint.y);
                    }
                    
                    e.preventDefault();
                }
            });
            
            gameScreen.addEventListener('mouseleave', function(e) {
                if (isPlaying && isSwipeActive) {
                    isSwipeActive = false;
                    
                    if (swipePoints.length > 1) {
                        const lastPoint = swipePoints[swipePoints.length - 1];
                        handleSwipeGesture(swipeStartX, swipeStartY, lastPoint.x, lastPoint.y);
                    }
                }
            });
            
            // ä¸ºæ‰€æœ‰æŒ‰é’®æ·»åŠ è§¦æ‘¸åé¦ˆ
            const buttons = document.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.95)';
                });
                
                btn.addEventListener('touchend', function() {
                    this.style.transform = '';
                });
            });
        }
        
        // ä¿®æ”¹åŸæœ‰çš„createFruitå‡½æ•°ï¼Œæ·»åŠ è§¦æ‘¸æ”¯æŒ
        const originalCreateFruit = createFruit;
        createFruit = function() {
            originalCreateFruit.apply(this, arguments);
            
            // ä¸ºæ–°åˆ›å»ºçš„æ°´æœæ·»åŠ è§¦æ‘¸äº‹ä»¶
            const fruits = document.querySelectorAll('.fruit:last-child');
            const newFruit = fruits[fruits.length - 1];
            
            if (newFruit) {
                newFruit.addEventListener('touchstart', function(e) {
                    if (isPlaying && !isSwipeActive) {
                        e.preventDefault();
                        e.stopPropagation();
                        this.style.transform = 'scale(1.1)';
                    }
                });
                
                newFruit.addEventListener('touchend', function(e) {
                    if (isPlaying && !isSwipeActive) {
                        e.preventDefault();
                        e.stopPropagation();
                        this.style.transform = '';
                        // ç›´æ¥è°ƒç”¨å¤„ç†å‡½æ•°
                        handleFruitInteraction(this);
                    }
                });
            }
        };
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', function() {
            // æ·»åŠ è§¦æ‘¸æ”¯æŒ
            addTouchSupport();
            
            // é˜²æ­¢ç§»åŠ¨ç«¯ç¼©æ”¾
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });
            
            // é˜²æ­¢åŒå‡»ç¼©æ”¾
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // ä¸ºå†ç©ä¸€æ¬¡æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
            restartBtn.addEventListener('click', function() {
                // éšè—æ¸¸æˆç»“æŸç•Œé¢
                gameOverScreen.style.display = 'none';
                initGame();
                startGame();
            });
            
            restartBtn.addEventListener('touchend', function(e) {
                e.preventDefault();
                gameOverScreen.style.display = 'none';
                initGame();
                startGame();
            });
            
            // åˆå§‹æ—¶å¦‚æœæ˜¯ç§»åŠ¨è®¾å¤‡ï¼Œä½¿ç”¨æ›´å¤§çš„æ¸¸æˆåŒºåŸŸ
            if (isMobile) {
                gameScreen.style.height = '50vh';
                gameScreen.style.minHeight = '300px';
            }
            
            // ç¡®ä¿é¡µé¢åœ¨æ¸¸æˆå¼€å§‹å‰å¯ä»¥æ»šåŠ¨
            document.body.style.overflow = 'auto';
            
            // åˆå§‹æ—¶å…è®¸gameScreenæ»šåŠ¨
            gameScreen.classList.add('scrollable');
        });
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
</html>
